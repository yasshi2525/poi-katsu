# ポイ活ウォーズ 実装計画

この実装計画は `specification/index.md` と `spec/specification.md` を参考に作成されています。

## 1. 基盤システム

### 1.1 データモデル設計
- **PlayerData**: プレイヤー情報（名前、アバター、ポイント、所持アイテム、タスク進行状況）
- **TaskData**: タスク情報（ID、タイトル、説明、完了条件、報酬、解禁条件）
- **ItemData**: アイテム情報（ID、名前、カテゴリ、購入価格、精算価格、セット情報）
- **NotificationData**: 通知情報（タイプ、メッセージ、表示タイミング）
- **GameContext**: ゲーム全体の状態管理

### 1.2 ゲーム進行管理システム
- **GamePhaseManager**: ゲームの進行段階を管理
- **TaskManager**: タスクの解禁・完了処理
- **PointManager**: ポイント計算・加算処理
- **ItemManager**: アイテム管理・セット判定
- **NotificationManager**: 通知システム

## 2. 画面・UI実装

### 2.1 タイトル画面 (TitleScene)
- **StartButtonE**: ゲーム開始ボタン
- **TitleLogoE**: タイトルロゴ表示
- **BackgroundE**: 背景アニメーション

### 2.2 ホーム画面 (MainScene内)
- **HomeE**: メインのホーム画面コンテナ
- **TaskListE**: タスク一覧表示コンポーネント
- **AppListE**: アプリ一覧表示コンポーネント
- **TimelineE**: タイムライン表示コンポーネント
- **AdBannerE**: 広告バナー表示コンポーネント

### 2.3 プロフィール画面 (MainScene内)
- **ProfileE**: プロフィール設定画面コンテナ
- **AvatarSelectorE**: アバター選択コンポーネント
- **NameInputE**: ユーザー名入力コンポーネント
- **ServiceLinkE**: 外部サービス連携コンポーネント

### 2.4 通販画面 (MainScene内)
- **ShopE**: 通販画面コンテナ
- **ProductListE**: 商品一覧表示コンポーネント
- **ProductDetailModalE**: 商品詳細モーダル
- **AffiliateShareE**: アフィリエイトシェア機能
- **PurchaseButtonE**: 購入ボタンコンポーネント

### 2.5 ソシャゲ画面 (MainScene内)
- **SocialGameE**: ソシャゲ画面コンテナ
- **LoginBonusE**: ログインボーナス機能
- **GachaModalE**: ガチャモーダル

### 2.6 フリマ画面 (MainScene内)
- **FleaMarketE**: フリマ画面コンテナ
- **MarketItemListE**: 出品アイテム一覧
- **SellModalE**: 商品出品モーダル

### 2.7 精算画面 (MainScene内)
- **SettlementE**: 精算画面コンテナ
- **SettlementResultE**: 精算結果表示
- **ItemConversionE**: アイテム変換表示

### 2.8 ランキング画面 (RankingScene)
- **PlayerRankingE**: プレイヤーランキング表示
- **PlayerDetailE**: プレイヤー詳細情報
- **ScoreBreakdownE**: スコア内訳表示

### 2.9 共通UI
- **HeaderE**: 固定ヘッダーコンポーネント（スコア、時間、プロフィール表示）
- **NotificationPopupE**: 通知ポップアップ
- **ConfirmDialogE**: 確認ダイアログ
- **LoadingE**: ローディング表示
- **ModalBackgroundE**: モーダル背景

## 3. ゲームロジック実装

### 3.1 タスクシステム
- **基本タスク**: プロフィール設定、外部サービス連携、広告タップ
- **発展タスク**: アフィリエイト、フリマ解禁
- タスク完了時の演出・報酬処理
- 次タスクの解禁処理

### 3.2 ポイント獲得システム
- **タイムライン機能**: フォロー・いいねによるポイント獲得
- **広告タップ**: 広告クリックによるポイント獲得
- **ソシャゲ**: ログインボーナス・ガチャによるポイント獲得
- **アフィリエイト**: 商品紹介・クリックによるポイント獲得
- **フリマ**: 商品売却によるポイント獲得

### 3.3 商品・アイテムシステム
- **小説シリーズ**: 上巻・下巻（200pt購入、150pt単品/1,000ptセット精算）
- **マンガシリーズ**: 1-5巻（100pt購入、50pt単品/2,500ptセット精算）
- セット判定ロジック
- 精算時の価格計算

### 3.4 通知システム
- **セール通知**: 定期的なセール・ポイント還元告知
- **ポイント獲得通知**: ポイント獲得時の通知
- **タスク完了通知**: タスク達成時の通知

## 4. マルチプレイヤー機能

### 4.1 プレイヤー間インタラクション
- **アフィリエイト**: 他プレイヤーの紹介商品クリック
- **フリマ**: 他プレイヤーとの商品売買
- **ランキング**: プレイヤー間のポイント比較

### 4.2 CPU補完機能
- 人数不足時のCPUプレイヤー生成
- CPU行動パターンの実装
- リアルタイムでの市場活動シミュレーション

## 5. 演出・アニメーション

### 5.1 画面遷移アニメーション
- スライド・フェード効果
- モーダルの表示・非表示演出

### 5.2 ポイント獲得演出
- ポイント加算アニメーション
- 成果達成時のエフェクト

### 5.3 商品購入・売却演出
- 購入完了時のアニメーション
- アイテム獲得演出

## 6. 実装優先順位

### Phase 1: 基盤システム
1. データモデル設計・実装
2. ゲーム進行管理システム
3. 基本的なUI コンポーネント

### Phase 2: 基本機能
1. タイトル画面・ホーム画面
2. プロフィール設定機能
3. 基本タスクシステム
4. ポイント表示・管理

### Phase 3: コア機能
1. 通販システム（商品購入）
2. タイムライン機能
3. ソシャゲ機能（ログインボーナス・ガチャ）
4. 通知システム

### Phase 4: 発展機能
1. アフィリエイト機能
2. フリマ機能
3. 精算システム
4. ランキングシステム

### Phase 5: 仕上げ
1. マルチプレイヤー対応
2. CPU補完機能
3. 演出・アニメーション強化
4. バランス調整

## 7. テスト戦略

### 7.1 ユニットテスト
- 各データモデルのテスト
- ポイント計算ロジックのテスト
- アイテムセット判定のテスト

### 7.2 統合テスト
- タスク進行フローのテスト
- 商品購入・売却フローのテスト
- 精算処理のテスト

### 7.3 E2Eテスト
- 仕様書のテストケースに基づく包括的テスト
- ゲーム全体の流れのテスト
- マルチプレイヤー機能のテスト

## 8. 技術的考慮事項

### 8.1 パフォーマンス
- アセット管理の最適化
- メモリ使用量の監視
- 描画パフォーマンスの最適化

### 8.2 保守性
- コンポーネントの再利用性
- 設定値の外部化
- ログ・デバッグ機能

### 8.3 拡張性
- 新商品追加の容易さ
- 新機能追加時の影響範囲最小化
- 設定データの柔軟性

## 9. ヘッダーアーキテクチャ

### 9.1 HeaderE設計思想
- **固定表示**: 画面遷移時も常に上部に表示される
- **グローバル管理**: MainSceneレベルで作成・管理される
- **PointDisplayE再利用**: 内部でPointDisplayEを使用し、表示ロジックを統一

### 9.2 配置・管理
- **MainScene**: HeaderEの作成と時刻更新を担当
- **HomeE**: HeaderEの参照を受け取り、スコア更新等で利用
- **ShopE等**: ヘッダーを隠さないよう、y: 80から開始するレイアウト

### 9.3 更新タイミング
- **時刻**: 秒が変わったときのみ更新（フレーム毎ではない）
- **スコア**: タスク完了やバナークリック時に即座に更新
- **プロフィール**: プロフィール変更時に更新

### 9.4 実装上の注意点
- **アニメーション**: スワイプアニメーション時はHeaderEを対象から除外
- **テスト**: HomeEテストではmockのHeaderEを提供する必要がある
- **依存関係**: HeaderE → PointDisplayE → その他表示コンポーネント